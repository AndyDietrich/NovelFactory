<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelFactory - Create Complete Books with AI | Professional Book Generator</title>
    <meta name="description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction with our advanced AI book generator. Try NovelFactory free today!">
    <meta name="keywords" content="AI book generator, novel writing AI, story generator, book creator, AI author, fiction generator, novel factory, AI writing tool, automated book creation">
    <meta name="author" content="NovelFactory">
    <meta name="robots" content="index, follow">

    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="NovelFactory - Create Complete Books with AI">
    <meta property="og:description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction with our advanced AI book generator.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://novelfactory.ink">
    <meta property="og:image" content="https://novelfactory.ink/og-image.jpg">
    <meta property="og:site_name" content="NovelFactory">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NovelFactory - Create Complete Books with AI">
    <meta name="twitter:description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction.">
    <meta name="twitter:image" content="https://novelfactory.ink/twitter-image.jpg">
    <meta name="twitter:site" content="@novelfactory">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://novelfactory.ink">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "NovelFactory",
        "description": "Fully automated AI-powered book generator for crafting complete novels and creating stories",
        "url": "https://novelfactory.ink",
        "applicationCategory": "Writing Tool",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>

    <link rel="stylesheet" href="styles.css">
    <style>
        /* General button size adjustments - makes all buttons a bit smaller */
        .btn {
            padding: 6px 12px !important;
            font-size: 14px !important;
            border-radius: 8px !important;
        }
        .btn-sm {
            padding: 4px 8px !important;
            font-size: 12px !important;
        }
        .btn-large {
            padding: 8px 14px !important;
            font-size: 15px !important;
        }
        /* Per-chapter collapse icon button inside chapter header */
        .collapse-chapter-btn {
            margin-left: auto;
            padding: 2px 4px;
            font-size: 10px;
            min-width: auto;
            width: 20px;
            height: 20px;
        }
        /* Chapter content collapse state tweaks (ensures content space is collapsed cleanly) */
        .chapter-content-field.collapsed { display: none !important; }
        /* Small override for the collapse button group layout in header if needed */
        .chapter-header { align-items: center; position: relative; }
        /* Position the collapse button at top-right (CSS supports absolute positioning) */
        .chapter-item .collapse-chapter-btn { position: absolute; top: 4px; right: 4px; z-index: 2; margin-left: 0; padding: 0; }
        /* Small helpers for per-chapter collapse icons in header alignment */
        .chapter-actions { display: flex; align-items: center; gap: 6px; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="favicon.ico" sizes="any">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RMFVPF4HSS"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-RMFVPF4HSS');
    </script>

</head>
<body data-theme="light">
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">NovelFactory</h1>
                    <p class="app-subtitle">Craft bestselling novels</p>
                </div>
                <div class="header-right">
                    <div class="theme-selector-container">
                        <select class="theme-selector" id="theme-select" onchange="changeTheme()">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="fun">Color</option>
                        </select>
                    </div>
                    <button class="header-btn" onclick="estimateCosts()">
                        <span class="label">Cost Estimate</span>
                    </button>
                    <button class="header-btn" onclick="showFeedbackForm()">
                        <span class="label">Feedback</span>
                    </button>
                    <button class="header-btn" onclick="showDonationModal()">
                        <span class="label">Donate</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Project Management -->
        <div class="project-bar">
            <div class="project-controls">
                <div class="project-select-wrapper">
                    <div class="project-menu">
                        <select id="project-select" class="project-selector" onchange="handleProjectAction(this.value)">
                            <option value="current">Current Project</option>
                        </select>
                    </div>
                </div>
                <div class="project-actions">
                    <button class="btn btn-ghost btn-sm" onclick="newProject()">
                        <span class="label">New</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="saveProject()">
                        <span class="label">Save</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="manageProjects()">
                        <span class="label">Manage</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" id="delete-project-btn" onclick="deleteCurrentProject()" style="display: none;">
                        <span class="label">Delete</span>
                    </button>
                </div>
                <input type="file" id="project-file" style="display: none;" accept=".json" onchange="importProject(event)">
            </div>
        </div>

        <!-- Navigation -->
        <nav class="navigation">
            <!--<div class="nav-progress">
                <div class="progress-line" id="nav-progress-line"></div>
            </div>-->
            <div class="nav-items">
                <button class="nav-item" onclick="showStep('settings')" data-step="settings">
                    <span class="nav-label">Settings</span>
                </button>
                <button class="nav-item active" onclick="showStep('setup')" data-step="setup">
                    <span class="nav-label">Book Setup</span>
                </button>
                <button class="nav-item" onclick="showStep('outline')" data-step="outline">
                    <span class="nav-label">Story Structure</span>
                </button>
                <button class="nav-item" onclick="showStep('chapters')" data-step="chapters">
                    <span class="nav-label">Chapter Planning</span>
                </button>
                <button class="nav-item" onclick="showStep('writing')" data-step="writing">
                    <span class="nav-label">Writing</span>
                </button>
                <button class="nav-item" onclick="showStep('export')" data-step="export">
                    <span class="nav-label">Export</span>
                </button>
                <button class="nav-item" onclick="showStep('tutorial')" data-step="tutorial">
                    <span class="nav-label">Tutorial</span>
                </button>
            </div>
        </nav>


        <!-- Main Content -->
        <main class="main-content">
            <!-- Setup Step -->
            <div id="setup" class="step active">
                <div class="step-header">
                    <h2 class="step-title">Book Setup</h2>
                    <p class="step-description">Define the foundation of your book by filling in the details below</p>
                </div>

                <div class="step-content">
                    <!-- Book Configuration -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="genre">Genre</label>
                            <select id="genre" onchange="updateGenreRequirements()">
                                <option value="">Select a genre...</option>
                                <option value="fantasy">Fantasy</option>
                                <option value="science-fiction">Science Fiction</option>
                                <option value="mystery">Mystery</option>
                                <option value="romance">Romance</option>
                                <option value="thriller">Thriller</option>
                                <option value="horror">Horror</option>
                                <option value="adventure">Adventure</option>
                                <option value="literary-fiction">Literary Fiction</option>
                                <option value="historical-fiction">Historical Fiction</option>
                                <option value="young-adult">Young Adult</option>
                                <option value="children">Children's</option>
                                <option value="non-fiction">Non-Fiction</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="target-audience">Target Audience</label>
                            <select id="target-audience" onchange="updateAudienceRequirements()">
                                <option value="">Select target audience...</option>
                                <option value="children-5-8">Children (5-8 years)</option>
                                <option value="children-9-12">Children (9-12 years)</option>
                                <option value="young-adult">Young Adult (13-17 years)</option>
                                <option value="new-adult">New Adult (18-25 years)</option>
                                <option value="adult">Adult (25+ years)</option>
                                <option value="general">General Audience</option>
                            </select>
                        </div>
                    </div>

                    <div id="genre-requirements" class="info-card" style="display: none;">
                        <h4>Genre-Specific Requirements</h4>
                        <div id="genre-requirements-content"></div>
                    </div>

                    <div class="form-group">
                        <label for="premise">Premise</label>
                        <div class="textarea-container">
                            <textarea id="premise" placeholder="What is your book about? Describe the main concept, conflict, or journey..." oninput="autoSave(); updateWordCount();"></textarea>
                            <div class="word-count" id="premise-word-count">0 words</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="style-direction">Style Direction</label>
                        <div class="textarea-container">
                            <textarea id="style-direction" placeholder="Describe the writing style you want (e.g., humorous, dark, poetic, fast-paced, descriptive...)" oninput="autoSave(); updateWordCount();"></textarea>
                            <div class="word-count" id="style-word-count">0 words</div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="num-chapters">Number of Chapters</label>
                            <input type="number" id="num-chapters" min="5" max="50" value="20" oninput="updateChapterEstimate()">
                            <div class="form-hint" id="chapter-estimate">Estimated book length: ~40,000 words</div>
                        </div>

                        <div class="form-group">
                            <label for="target-word-count">Target Words per Chapter</label>
                            <input type="number" id="target-word-count" min="1000" max="8000" value="2000">
                            <div class="form-hint">Recommended: 2000-4000 for most genres</div>
                        </div>
                    </div>

                    <!-- Action Buttons at Bottom -->
                    <div class="setup-actions">
                        <div class="random-idea-section">
                            <button class="btn btn-blue-grey" onclick="generateRandomIdea()" id="random-idea-btn" style="display: none;">
                                <span class="label">Generate Random Idea</span>
                            </button>
                            <p class="random-idea-hint">Select genre and target audience first, then generate a unique book idea!</p>
                        </div>

                        <div class="main-setup-actions">
                            <button class="btn btn-success btn-large" onclick="collectBookData(); autoSave(); showStep('outline'); window.scrollTo({top: 0, behavior: 'smooth'})">
                                <span class="label">Next: Story Structure</span>
                            </button>
                            <button class="btn btn-primary btn-large one-click-btn" onclick="startOneClickGeneration()">
                                <span class="label">1-Click Generation</span>
                            </button>
                        </div>

                        <div class="secondary-actions">
                            <button class="btn btn-danger btn-sm" onclick="resetEverything()">
                                <span class="label">Reset & Start New</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Story Structure Step -->
            <div id="outline" class="step">
                <div class="step-header">
                    <h2 class="step-title">Story Structure & Characters</h2>
                    <p class="step-description">Plot out a story structure and Characters for your novel</p>
                </div>

                <div class="step-content">
                    <!-- Primary Generation Actions -->
                    <div class="primary-actions-section">
                        <div class="main-generation-actions">
                            <button class="btn btn-primary btn-large" onclick="generateOutline()">
                                <span class="label">Generate Story Structure</span>
                            </button>
                            <button class="btn btn-primary" onclick="showOutlineEditModal()">
                                <span class="label">Edit</span>
                            </button>
                        </div>
                    </div>

                    <!-- Content Field -->
                    <div class="form-group">
                        <label for="outline-content">Story Structure & Characters</label>
                        <div class="textarea-container">
                            <textarea id="outline-content" 
                                    placeholder="Type or paste your story structure here, or use AI generation above..." 
                                    rows="20"
                                    oninput="saveOutlineContent()"></textarea>
                            <div class="word-count" id="outline-word-count">0 words</div>
                        </div>
                        <div class="form-hint">Enter your complete story structure including plot outline, character development, three-act structure, etc.</div>
                    </div>

                    <!-- Combined Advanced Settings -->
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleCollapsibleSection(this)">
                            <span class="toggle-icon">▼</span>
                            <h3>Advanced Settings & Quality Enhancement</h3>
                        </div>
                        <div class="collapsible-content">
                            <div class="feedback-controls">
                                <h4>Quality Enhancement & Feedback</h4>
                                <div class="feedback-options">
                                    <label>
                                        <span>Feedback Mode:</span>
                                        <select id="outline-feedback-mode">
                                            <option value="ai">AI Analysis</option>
                                            <option value="manual">Manual Feedback</option>
                                        </select>
                                    </label>
                                    <label>
                                        <span>Feedback Loops:</span>
                                        <select id="outline-feedback-loops">
                                            <option value="0">No feedback</option>
                                            <option value="1">1 loop</option>
                                            <option value="2">2 loops</option>
                                            <option value="3">3 loops</option>
                                            <option value="5">5 loops</option>
                                        </select>
                                    </label>
                                    <div class="feedback-buttons">
                                        <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('outline')">
                                            <span class="label">Run Feedback Loop</span>
                                        </button>
                                    </div>
                                </div>

                                <div id="outline-manual-feedback" class="manual-feedback-section" style="display: none;">
                                    <label for="outline-manual-input">Manual Feedback Instructions:</label>
                                    <textarea id="outline-manual-input" placeholder="Describe what you'd like to improve or change about the story structure..." rows="4"></textarea>
                                </div>
                            </div>

                            <div class="prompt-editor">
                                <h4>Prompt Customization</h4>
                                <label for="outline-prompt">Story Structure Generation Prompt</label>
                                <textarea id="outline-prompt" class="prompt-textarea"></textarea>
                            </div>

                            <div id="outline-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                                <label for="outline-feedback-prompt">Feedback Analysis Prompt:</label>
                                <textarea id="outline-feedback-prompt" rows="6"></textarea>
                                <div class="prompt-actions">
                                    <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('outline')">Reset to Default</button>
                                    <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('outline')">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="step-actions">
                        <button class="btn btn-success btn-large" onclick="proceedToChapters(); window.scrollTo({top: 0, behavior: 'smooth'});" id="outline-next" style="display: none;">
                            <span class="label">Next: Chapter Planning</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chapter Planning Step -->
            <div id="chapters" class="step">
                <div class="step-header">
                    <h2 class="step-title">Chapter Planning</h2>
                    <p class="step-description">Create a detailed chapter plan for your novel</p>
                </div>

                <div class="step-content">
                    <!-- Primary Generation Actions -->
                    <div class="primary-actions-section">
                        <div class="main-generation-actions">
                            <button class="btn btn-primary btn-large" onclick="generateChapterOutline()">
                                <span class="label">Generate Chapter Plan</span>
                            </button>
                            <button class="btn btn-primary" onclick="showChapterOutlineEditModal()">
                                <span class="label">Edit</span>
                            </button>
                        </div>
                    </div>

                    <!-- Content Field -->
                    <div class="form-group">
                        <label for="chapters-content">Chapter-by-Chapter Plan</label>
                        <div class="textarea-container">
                            <textarea id="chapters-content" 
                                    placeholder="Type or paste your detailed chapter plan here, or use AI generation above..." 
                                    rows="25"
                                    oninput="saveChaptersContent()"></textarea>
                            <div class="word-count" id="chapters-word-count">0 words</div>
                        </div>
                        <div class="form-hint">Enter your complete chapter plan including chapter titles, scene breakdowns, plot points, etc.</div>
                    </div>

                    <!-- Combined Advanced Settings -->
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleCollapsibleSection(this)">
                            <span class="toggle-icon">▼</span>
                            <h3>Advanced Settings & Quality Enhancement</h3>
                        </div>
                        <div class="collapsible-content">
                            <div class="feedback-controls">
                                <h4>Quality Enhancement & Feedback</h4>
                                <div class="feedback-options">
                                    <label>
                                        <span>Feedback Mode:</span>
                                        <select id="chapters-feedback-mode">
                                            <option value="ai">AI Analysis</option>
                                            <option value="manual">Manual Feedback</option>
                                        </select>
                                    </label>
                                    <label>
                                        <span>Feedback Loops:</span>
                                        <select id="chapters-feedback-loops">
                                            <option value="0">No feedback</option>
                                            <option value="1">1 loop</option>
                                            <option value="2">2 loops</option>
                                            <option value="3">3 loops</option>
                                            <option value="5">5 loops</option>
                                        </select>
                                    </label>
                                    <div class="feedback-buttons">
                                        <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('chapters')">
                                            <span class="label">Run Feedback Loop</span>
                                        </button>
                                    </div>
                                </div>

                                <div id="chapters-manual-feedback" class="manual-feedback-section" style="display: none;">
                                    <label for="chapters-manual-input">Manual Feedback Instructions:</label>
                                    <textarea id="chapters-manual-input" placeholder="Describe what you'd like to improve or change about the chapter planning..." rows="4"></textarea>
                                </div>
                            </div>

                            <div class="prompt-editor">
                                <h4>Prompt Customization</h4>
                                <label for="chapters-prompt">Chapter Planning Prompt</label>
                                <textarea id="chapters-prompt" class="prompt-textarea"></textarea>
                            </div>

                            <div id="chapters-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                                <label for="chapters-feedback-prompt">Feedback Analysis Prompt:</label>
                                <textarea id="chapters-feedback-prompt" rows="6"></textarea>
                                <div class="prompt-actions">
                                    <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('chapters')">Reset to Default</button>
                                    <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('chapters')">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Per-chapter collapse icons are added in the JS when building the chapter items. No global collapse button now. -->

                    <!-- Navigation -->
                    <div class="step-actions">
                        <button class="btn btn-success btn-large" onclick="proceedToWriting(); window.scrollTo({top: 0, behavior: 'smooth'})" id="chapters-next" style="display: none;">
                            <span class="label">Next: Writing</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Writing Step -->
            <div id="writing" class="step">
                <div class="step-header">
                    <h2 class="step-title">Writing Chapters</h2>
                    <p class="step-description">Write prose for your book</p>
                </div>

                <div class="step-content">
                    
                    <!-- Writing Container -->
                    <div id="chapters-container">
                        <div class="writing-placeholder">
                            <p>Setting up writing interface...</p>
                        </div>
                    </div>

                    <!-- Combined Advanced Settings -->
                    <div class="collapsible-section">
                        <div class="collapsible-header" onclick="toggleCollapsibleSection(this)">
                            <span class="toggle-icon">▼</span>
                            <h3>Advanced Settings & Quality Enhancement</h3>
                        </div>
                        <div class="collapsible-content">
                            <div class="feedback-controls">
                                <h4>Quality Enhancement & Feedback</h4>
                                <div class="feedback-options">
                                    <label>
                                        <span>Feedback Mode:</span>
                                        <select id="writing-feedback-mode">
                                            <option value="ai">AI Analysis</option>
                                            <option value="manual">Manual Feedback</option>
                                        </select>
                                    </label>
                                    <label>
                                        <span>Feedback Loops:</span>
                                        <select id="writing-feedback-loops">
                                            <option value="0">No feedback</option>
                                            <option value="1">1 loop</option>
                                            <option value="2">2 loops</option>
                                            <option value="3">3 loops</option>
                                            <option value="5">5 loops</option>
                                        </select>
                                    </label>
                                    <div class="feedback-buttons">
                                        <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('writing')">
                                            <span class="label">Run Feedback Loop</span>
                                        </button>
                                    </div>
                                </div>

                                <div id="writing-manual-feedback" class="manual-feedback-section" style="display: none;">
                                    <label for="writing-manual-input">Manual Feedback Instructions:</label>
                                    <textarea id="writing-manual-input" placeholder="Describe what you'd like to improve or change about the writing..." rows="4"></textarea>
                                </div>
                            </div>

                            <div class="prompt-editor">
                                <h4>Prompt Customization</h4>
                                <label for="writing-prompt">Chapter Writing Prompt</label>
                                <textarea id="writing-prompt" class="prompt-textarea"></textarea>
                            </div>

                            <div id="writing-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                                <label for="writing-feedback-prompt">Feedback Analysis Prompt:</label>
                                <textarea id="writing-feedback-prompt" rows="6"></textarea>
                                <div class="prompt-actions">
                                    <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('writing')">Reset to Default</button>
                                    <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('writing')">Save Changes</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="writing-footer">
                        <button class="btn btn-success btn-large" onclick="proceedToExport(); window.scrollTo({top: 0, behavior: 'smooth'})" style="display: none;" id="writing-next">
                            <span class="label">Next: Export</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Export Step -->
            <div id="export" class="step">
                <div class="step-header">
                    <h2 class="step-title">Export Your Book</h2>
                    <p class="step-description">Download your completed book in different formats</p>
                </div>

                <div class="step-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-words">0</div>
                            <div class="stat-label">Total Words</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-chapters">0</div>
                            <div class="stat-label">Chapters</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avg-words">0</div>
                            <div class="stat-label">Avg Words/Chapter</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="reading-time">0</div>
                            <div class="stat-label">Reading Time (min)</div>
                        </div>
                    </div>

                    <div class="export-grid">
                        <div class="export-card">
                            <h4>Text Format</h4>
                            <p>Simple text file for basic reading</p>
                            <button class="btn btn-primary" onclick="downloadBook('txt')">Download TXT</button>
                        </div>
                        <div class="export-card">
                            <h4>HTML Format</h4>
                            <p>Web-ready format with styling</p>
                            <button class="btn btn-primary" onclick="downloadBook('html')">Download HTML</button>
                        </div>
                        <div class="export-card">
                            <h4>Markdown Format</h4>
                            <p>Universal format for publishing platforms</p>
                            <button class="btn btn-primary" onclick="downloadBook('md')">Download Markdown</button>
                        </div>
                        <!-- EPUB export removed per feedback -->
                        <div class="export-card">
                            <h4>Copy to Clipboard</h4>
                            <p>Quick copy for pasting elsewhere</p>
                            <button class="btn btn-primary" onclick="copyToClipboard()">Copy Text</button>
                        </div>
                        <!-- Google Drive export removed per feedback -->
                    </div>
                </div>
            </div>

            <!-- Settings Step -->
            <div id="settings" class="step">
                <div class="step-header">
                    <h2 class="step-title">AI Settings & Configuration</h2>
                    <p class="step-description">Configure your AI settings and customize all generation prompts</p>
                </div>

                <div class="step-content">
                    <div class="settings-section">
                        <h3>API Configuration</h3>
                        
                        <div class="api-provider-toggle">
                            <div class="toggle-group">
                                <button class="toggle-btn active" onclick="switchApiProvider('openrouter')" id="openrouter-btn">
                                    OpenRouter
                                </button>
                                <button class="toggle-btn" onclick="switchApiProvider('openai')" id="openai-btn">
                                    OpenAI
                                </button>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group" id="openrouter-key-group">
                                <label for="openrouter-api-key">OpenRouter API Key</label>
                                <input type="password" id="openrouter-api-key" placeholder="Enter your OpenRouter API key..." onchange="saveSettings(); updateModelSelect()">
                                <div class="form-hint">Get your API key from <a href="https://openrouter.ai" target="_blank">openrouter.ai</a></div>
                            </div>

                            <div class="form-group" id="openai-key-group" style="display: none;">
                                <label for="openai-api-key">OpenAI API Key</label>
                                <input type="password" id="openai-api-key" placeholder="Enter your OpenAI API key..." onchange="saveSettings(); updateModelSelect()">
                                <div class="form-hint">Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></div>
                            </div>

                            <div class="form-group">
                                <label for="model-select">Default AI Model</label>
                                <select id="model-select" onchange="updateModelInfo(); saveSettings()">
                                    <!-- Models will be populated by JavaScript -->
                                </select>
                                <div id="model-cost-info" class="form-hint">Cost information will appear here</div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="temperature">Temperature (Creativity): <span id="temp-value">0.7</span></label>
                                <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" oninput="updateTempValue(); saveSettings()">
                                <div class="form-hint">Higher = more creative, Lower = more focused</div>
                            </div>

                            <div class="form-group">
                                <label for="max-tokens">Max Tokens per Request</label>
                                <input type="number" id="max-tokens" min="1000" max="1000000" value="50000" onchange="saveSettings()">
                                <div class="form-hint">Maximum length of each AI response</div>
                            </div>
                        </div>

                        <div class="settings-actions">
                            <button class="btn btn-primary" onclick="testApiConnection()">
                                <span class="label">Test Connection</span>
                            </button>
                            <button class="btn btn-ghost" onclick="exportSettings()">
                                <span class="label">Export Settings</span>
                            </button>
                            <button class="btn btn-ghost" onclick="importSettings()">
                                <span class="label">Import Settings</span>
                            </button>
                        </div>

                        <div id="api-status"></div>
                    </div>

                    <!-- Advanced Model Selection Toggle -->
                    <div class="advanced-models-toggle-section">
                        <div class="toggle-section-header">
                            <div class="toggle-info">
                                <h4>Advanced Model Selection</h4>
                                <p class="toggle-description">Use different AI models for different generation steps</p>
                            </div>
                            <div class="toggle-switch-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enable-advanced-models" onchange="saveAdvancedModelSettings(); updateAdvancedModelsVisualState()">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-status" id="advanced-models-status">Disabled</span>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Models Configuration (Expandable) -->
                    <div class="advanced-models-expandable" id="advanced-models-expandable" style="display: none;">
                        <div class="advanced-models-content">
                            <h5 class="section-description">Choose specific AI models for different parts of the book generation process. Each model has different strengths.</h5>
                            
                            <div class="advanced-models-grid">
                                    <div class="model-setting">
                                        <label for="advanced-model-outline">Story Structure Generation</label>
                                        <select id="advanced-model-outline" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="model-setting">
                                        <label for="advanced-model-chapters">Chapter Planning</label>
                                        <select id="advanced-model-chapters" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="model-setting">
                                        <label for="advanced-model-writing">Chapter Writing</label>
                                        <select id="advanced-model-writing" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="model-setting">
                                        <label for="advanced-model-feedback">Feedback & Analysis</label>
                                        <select id="advanced-model-feedback" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="model-setting">
                                        <label for="advanced-model-randomIdea">Random Ideas</label>
                                        <select id="advanced-model-randomIdea" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                    
                                    <div class="model-setting">
                                        <label for="advanced-model-bookTitle">Book Title & Blurb</label>
                                        <select id="advanced-model-bookTitle" onchange="saveAdvancedModelSettings()">
                                            <option value="">Use Default Model</option>
                                            <!-- Populated by JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="advanced-models-actions">
                                    <button class="btn btn-ghost btn-sm" onclick="resetAdvancedModelSettings()">
                                        <span class="label">Reset All to Default</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Prompts Section -->
                    <div class="collapsible-section custom-prompts-section">
                        <div class="collapsible-header" onclick="toggleCollapsibleSection(this)">
                            <span class="toggle-icon">▼</span>
                            <h3>Custom Prompts</h3>
                        </div>
                        <div class="collapsible-content">
                            <div class="custom-prompts-container">
                                <p class="section-description">Customize the AI generation prompts for each step. Changes are saved automatically.</p>
                                
                                <div class="prompt-editors">
                                    <div class="prompt-group">
                                        <label for="settings-outline-prompt">Story Structure Generation Prompt</label>
                                        <textarea id="settings-outline-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('outline')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('outline')">Reset to Default</button>
                                    </div>

                                    <div class="prompt-group">
                                        <label for="settings-chapters-prompt">Chapter Planning Prompt</label>
                                        <textarea id="settings-chapters-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('chapters')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('chapters')">Reset to Default</button>
                                    </div>

                                    <div class="prompt-group">
                                        <label for="settings-writing-prompt">Chapter Writing Prompt</label>
                                        <textarea id="settings-writing-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('writing')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('writing')">Reset to Default</button>
                                    </div>

                                    <div class="prompt-group">
                                        <label for="settings-analysis-prompt">Feedback Analysis Prompt</label>
                                        <textarea id="settings-analysis-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('analysis')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('analysis')">Reset to Default</button>
                                    </div>

                                    <div class="prompt-group">
                                        <label for="settings-randomidea-prompt">Random Idea Generation Prompt</label>
                                        <textarea id="settings-randomidea-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('randomIdea')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('randomIdea')">Reset to Default</button>
                                    </div>

                                    <div class="prompt-group">
                                        <label for="settings-booktitle-prompt">Book Title & Blurb Generation Prompt</label>
                                        <textarea id="settings-booktitle-prompt" class="prompt-textarea" rows="8" onchange="saveCustomPrompt('bookTitle')"></textarea>
                                        <button class="btn btn-ghost btn-sm" onclick="resetCustomPrompt('bookTitle')">Reset to Default</button>
                                    </div>
                                </div>

                                <div class="custom-prompts-actions">
                                    <button class="btn btn-ghost" onclick="resetAllCustomPrompts()">
                                        <span class="label">Reset All Prompts</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>

            <!-- Tutorial Step -->
            <div id="tutorial" class="step">
                <div class="step-header">
                    <h2 class="step-title">Tutorial & Guide</h2>
                    <p class="step-description">Complete guide and information to using NovelFactory</p>
                </div>

                <div class="step-content">
                    <div class="tutorial-section">
                        <h3>Getting Started</h3>

                        <div class="tutorial-card">
                            <h4>Data Storage & Privacy</h4>
                            <p>Your data security and privacy:</p>
                            <ul>
                                <li><strong>Local Storage:</strong> All projects are stored locally in your browser</li>
                                <li><strong>No External Servers:</strong> Your content never leaves your device</li>
                                <li><strong>Secure API Keys:</strong> Stored securely in browser local storage</li>
                                <li><strong>Direct AI Communication:</strong> Direct connection to AI providers only</li>
                            </ul>
                        </div>
                        
                        <div class="tutorial-card">
                            <h4>AI Settings Configuration</h4>
                            <p>Set up your AI connection:</p>
                            <ul>
                                <li><strong>API Providers:</strong> Choose OpenRouter or OpenAI</li>
                                <li><strong>Model Selection:</strong> Different models for different needs</li>
                                <li><strong>Advanced Models:</strong> Customize models per generation step</li>
                                <li><strong>Temperature:</strong> Control creativity vs consistency (0-1)</li>
                                <li><strong>Custom Prompts:</strong> Modify generation behavior</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Book Creation Process</h4>
                            <p>Follow the structured approach:</p>
                            <ul>
                                <li><strong>Book Setup:</strong> Define genre, audience, premise, and style</li>
                                <li><strong>Story Structure:</strong> Create complete narrative framework</li>
                                <li><strong>Chapter Planning:</strong> Detailed scene-by-scene breakdown</li>
                                <li><strong>Writing:</strong> Generate professional prose</li>
                                <li><strong>Export:</strong> Download in multiple formats</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Iterations and Editing</h4>
                            <p>Improve your content with feedback loops:</p>
                            <ul>
                                <li><strong>AI Analysis:</strong> Automated quality assessment</li>
                                <li><strong>Manual Feedback:</strong> Provide specific improvement instructions</li>
                                <li><strong>Multiple Iterations:</strong> Run 1-5 improvement cycles</li>
                                <li><strong>Step-by-Step:</strong> Enhance structure, planning, and writing</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Advanced Features</h3>

                        <div class="tutorial-card">
                            <h4>One-Click Generation</h4>
                            <p>Automated book creation:</p>
                            <ul>
                                <li>Configure feedback loops for each step</li>
                                <li>AI handles the entire process automatically</li>
                                <li>Complete book from setup to export</li>
                                <li>Perfect for rapid prototyping</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Advanced Model Selection</h4>
                            <p>Optimize performance and cost:</p>
                            <ul>
                                <li><strong>Step-Specific Models:</strong> Different models for different tasks</li>
                                <li><strong>Variety of Models:</strong> Balance quality and cost</li>
                                <li><strong>Model Specialization:</strong> Some excel at specific tasks</li>
                                <li><strong>Cost Optimization:</strong> Strategic model usage</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Project Management</h4>
                            <p>Organize your writing projects:</p>
                            <ul>
                                <li>Save multiple book projects</li>
                                <li>Load previous work seamlessly</li>
                                <li>Export/import for backup</li>
                                <li>Auto-save every 30 seconds</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Content Editing</h3>

                        <div class="tutorial-card">
                            <h4>Edit Mode Selection</h4>
                            <p>Choose your editing approach:</p>
                            <ul>
                                <li><strong>Automated Mode:</strong> AI analyzes and improves content automatically</li>
                                <li><strong>Manual Mode:</strong> Provide specific feedback for targeted improvements</li>
                                <li><strong>Smart Detection:</strong> AI identifies areas needing improvement</li>
                                <li><strong>Quality Enhancement:</strong> Improve prose, pacing, and consistency</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Editing Different Content Types</h4>
                            <p>Edit any part of your book:</p>
                            <ul>
                                <li><strong>Story Outline:</strong> Refine plot structure and narrative flow</li>
                                <li><strong>Chapter Outlines:</strong> Improve scene planning and pacing</li>
                                <li><strong>Chapter Content:</strong> Enhance prose, dialogue, and descriptions</li>
                                <li><strong>Iterative Process:</strong> Make multiple rounds of improvements</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Best Editing Practices</h4>
                            <p>Maximize editing effectiveness:</p>
                            <ul>
                                <li><strong>Specific Feedback:</strong> Be clear about what needs improvement</li>
                                <li><strong>Review Changes:</strong> Always check AI edits before accepting</li>
                                <li><strong>Incremental Updates:</strong> Make small, focused improvements</li>
                                <li><strong>Maintain Voice:</strong> Ensure edits preserve your writing style</li>
                                <li><strong>Test Different Modes:</strong> Try both automated and manual approaches</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Tips & Best Practices</h3>

                        <div class="tutorial-card">
                            <h4>Writing Quality Tips</h4>
                            <ul>
                                <li>Use feedback loops for better quality</li>
                                <li>Review and edit AI-generated content</li>
                                <li>Maintain consistency in character voices</li>
                                <li>Follow genre-specific requirements</li>
                                <li>Export regularly to backup work</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Cost Management</h4>
                            <ul>
                                <li>Use cost estimation before generation</li>
                                <li>Budget models for drafts, premium for final</li>
                                <li>Optimize feedback loops usage</li>
                                <li>Monitor token usage patterns</li>
                                <li>Generate chapters individually to control costs</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Troubleshooting</h4>
                            <ul>
                                <li><strong>API Errors:</strong> Check key and connection</li>
                                <li><strong>Slow Generation:</strong> Reduce tokens or try faster model</li>
                                <li><strong>Quality Issues:</strong> Use more feedback loops</li>
                                <li><strong>Generation Stuck:</strong> Wait for completion, only one at a time</li>
                                <li><strong>Lost Work:</strong> Check auto-save in browser storage</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Generation Progress Indicator -->
    <div class="generation-indicator" id="generation-indicator">
        <div class="generation-animation"></div>
        <div class="generation-text">
            <h3 id="generation-title">AI Generation in Progress</h3>
            <p id="generation-description">Please wait while the AI processes your request...</p>
        </div>
    </div>

    <!-- Auto-save Indicator -->
    <div id="auto-save-indicator" class="auto-save-indicator">Auto-saved</div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="modal custom-alert-modal">
        <div class="modal-content alert-content">
            <div class="alert-header">
                <h3 id="alert-title">Notification</h3>
            </div>
            <div class="alert-body">
                <div id="alert-message">Alert message will appear here</div>
            </div>
            <div class="alert-footer">
                <button class="btn btn-primary" id="alert-ok-btn" onclick="closeCustomAlert()">OK</button>
                <button class="btn btn-ghost" id="alert-cancel-btn" onclick="closeCustomAlert(false)" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Input Modal -->
    <div id="custom-input-modal" class="modal custom-input-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="input-title">Input Required</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeCustomInput(null)">Close</button>
            </div>
            <div class="modal-body">
                <p id="input-message">Please enter a value:</p>
                <input type="text" id="input-field" class="input-field" placeholder="Enter value...">
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="input-cancel-btn">Cancel</button>
                <button class="btn btn-primary" id="input-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Expanded Chapter Modal -->
    <div id="expand-modal" class="expand-modal">
        <div class="expand-header">
            <div class="expand-title">
                <h3 id="expand-chapter-title">Chapter 1 - Expanded View</h3>
                <div class="expand-info">
                    <span id="expand-word-count">0 words</span>
                    <span id="expand-reading-time">0 min read</span>
                </div>
            </div>
            <div class="expand-controls">
                <button class="btn btn-ghost btn-sm" onclick="toggleExpandedReadMode()">
                    <span id="read-mode-label">Read Mode</span>
                </button>
                <button class="btn btn-success btn-sm" onclick="saveExpandedChapter()">
                    <span class="label">Save Changes</span>
                </button>
                <button class="btn btn-danger btn-sm" onclick="closeExpandModal()">
                    <span class="label">Close</span>
                </button>
            </div>
        </div>
        <div class="expand-content">
            <div class="expand-editor" id="expand-editor">
                <textarea id="expand-textarea" placeholder="Chapter content..." oninput="updateExpandedWordCount()"></textarea>
            </div>
            <div class="expand-reader" id="expand-reader" style="display: none;">
                <div id="expand-reader-content"></div>
            </div>
        </div>
    </div>

    <!-- One-Click Generation Modal -->
    <div id="one-click-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>1-Click Generation Configuration</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeOneClickModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Configure feedback loops for each generation step:</p>
                
                <div class="one-click-config">
                    <div class="config-row">
                        <label>Story Structure Feedback Loops:</label>
                        <select id="one-click-outline-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label>Chapter Planning Feedback Loops:</label>
                        <select id="one-click-chapters-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label>Writing Feedback Loops:</label>
                        <select id="one-click-writing-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeOneClickModal()">Cancel</button>
                <button class="btn btn-primary" onclick="startOneClickProcess()">
                    <span class="label">Start Generation</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Project Management Modal -->
    <div id="project-management-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manage Projects</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeProjectManagementModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="project-management-content">
                    <div class="project-stats">
                        <p>Saved Projects: <span id="project-count">0</span>/10</p>
                        <div class="progress-bar">
                            <div id="project-count-progress" class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                    
                    <div id="project-list" class="project-list">
                        <!-- Projects will be populated here -->
                    </div>
                    
                    <div class="project-management-actions">
                        <button class="btn btn-ghost btn-sm" onclick="exportAllProjects()">
                            <span class="label">Export All</span>
                        </button>
                        <button class="btn btn-ghost btn-sm" onclick="importProjects()">
                            <span class="label">Import Projects</span>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="clearAllProjects()">
                            <span class="label">Clear All</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Feedback</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeFeedbackModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="feedback-type">Feedback Type</label>
                    <select id="feedback-type">
                        <option value="bug">Bug Report</option>
                        <option value="feature">Feature Request</option>
                        <option value="improvement">Improvement Suggestion</option>
                        <option value="question">Question</option>
                        <option value="praise">Compliment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedback-message">Your Feedback</label>
                    <textarea id="feedback-message" rows="6" placeholder="Please describe your feedback in detail..."></textarea>
                </div>
                <div class="form-group">
                    <label for="feedback-email">Email (optional)</label>
                    <input type="email" id="feedback-email" placeholder="your@email.com">
                    <div class="form-hint">Leave your email if you'd like a response</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitFeedback()">
                    <span class="label">Send Feedback</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Chapter Edit Modal -->
    <div id="chapter-edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="chapter-edit-title">Edit Chapter</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeChapterEditModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="edit-mode-selection">
                    <h4>Edit Mode</h4>
                    <div class="edit-mode-buttons">
                        <button class="edit-mode-btn active" data-mode="automated" onclick="selectEditMode('automated')">
                            <div class="mode-content">
                                <strong>Automated</strong>
                                <small>AI analyzes and improves the chapter automatically</small>
                            </div>
                        </button>
                        <button class="edit-mode-btn" data-mode="manual" onclick="selectEditMode('manual')">
                            <div class="mode-content">
                                <strong>Manual</strong>
                                <small>Provide specific feedback for AI to implement</small>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div id="manual-edit-feedback" class="manual-edit-section" style="display: none;">
                    <label for="chapter-edit-instructions">Edit Instructions:</label>
                    <textarea id="chapter-edit-instructions" placeholder="Describe what you'd like to change or improve about this chapter..." rows="4"></textarea>
                </div>
                
                <div class="edit-loops-section">
                    <label for="chapter-edit-loops">Number of Edit Loops:</label>
                    <select id="chapter-edit-loops">
                        <option value="1">1 loop</option>
                        <option value="2">2 loops</option>
                        <option value="3">3 loops</option>
                        <option value="5">5 loops</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeChapterEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="executeChapterEdit()" id="execute-edit-btn">
                    <span class="label">Start Editing</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Outline Edit Modal -->
    <div id="outline-edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Story Structure</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeOutlineEditModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="edit-mode-selection">
                    <h4>Edit Mode</h4>
                    <div class="edit-mode-buttons">
                        <button class="edit-mode-btn active" data-mode="automated" onclick="selectOutlineEditMode('automated')">
                            <div class="mode-content">
                                <strong>Automated</strong>
                                <small>AI analyzes and improves the story structure automatically</small>
                            </div>
                        </button>
                        <button class="edit-mode-btn" data-mode="manual" onclick="selectOutlineEditMode('manual')">
                            <div class="mode-content">
                                <strong>Manual</strong>
                                <small>Provide specific feedback for AI to implement</small>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div id="manual-outline-edit-feedback" class="manual-edit-section" style="display: none;">
                    <label for="outline-edit-instructions">Edit Instructions:</label>
                    <textarea id="outline-edit-instructions" placeholder="Describe what you'd like to change or improve about the story structure..." rows="4"></textarea>
                </div>

                <div class="feedback-loops-section">
                    <label for="outline-edit-loops">Number of edit loops:</label>
                    <select id="outline-edit-loops">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeOutlineEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="executeOutlineEdit()" id="execute-outline-edit-btn">
                    <span class="label">Start Editing</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Chapter Outline Edit Modal -->
    <div id="chapter-outline-edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Chapter Plan</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeChapterOutlineEditModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="edit-mode-selection">
                    <h4>Edit Mode</h4>
                    <div class="edit-mode-buttons">
                        <button class="edit-mode-btn active" data-mode="automated" onclick="selectChapterOutlineEditMode('automated')">
                            <div class="mode-content">
                                <strong>Automated</strong>
                                <small>AI analyzes and edits the chapter plan</small>
                            </div>
                        </button>
                        <button class="edit-mode-btn" data-mode="manual" onclick="selectChapterOutlineEditMode('manual')">
                            <div class="mode-content">
                                <strong>Manual</strong>
                                <small>Provide specific feedback for AI to implement</small>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div id="manual-chapter-outline-edit-feedback" class="manual-edit-section" style="display: none;">
                    <label for="chapter-outline-edit-instructions">Edit Instructions:</label>
                    <textarea id="chapter-outline-edit-instructions" placeholder="Describe what you'd like to change or improve about the chapter plan..." rows="4"></textarea>
                </div>

                <div class="feedback-loops-section">
                    <label for="chapter-outline-edit-loops">Number of edit loops:</label>
                    <select id="chapter-outline-edit-loops">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeChapterOutlineEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="executeChapterOutlineEdit()" id="execute-chapter-outline-edit-btn">
                    <span class="label">Start Editing</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Donation Modal -->
    <div id="donation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Support NovelFactory</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeDonationModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="donation-content">
                    <p><strong>NovelFactory is completely free to use!</strong></p>
                    <p>If you find this tool helpful and would like to support its development, consider buying me a coffee. Your support helps me:</p>
                    <ul>
                        <li>Keep the service free for everyone</li>
                        <li>Add new features and improvements</li>
                        <li>Maintain and improve the platform</li>
                        <li>Create better AI writing tools</li>
                    </ul>
                    
                    <div class="donation-options">
                        <h4>Choose an amount:</h4>
                        <div class="donation-buttons">
                            <button class="btn btn-ghost donation-amount selected" onclick="setDonationAmount(5)">
                                <span class="label">$5 Coffee</span>
                            </button>
                            <button class="btn btn-ghost donation-amount" onclick="setDonationAmount(10)">
                                <span class="label">$10 Meal</span>
                            </button>
                            <button class="btn btn-ghost donation-amount" onclick="setDonationAmount(25)">
                                <span class="label">$25 Generous</span>
                            </button>
                        </div>
                        
                        <div class="custom-amount">
                            <label>Or enter custom amount (USD):</label>
                            <input type="number" id="custom-donation-amount" min="1" placeholder="Enter amount">
                        </div>
                    </div>
                    
                    <p class="donation-note"><em>Every contribution, no matter how small, means the world to us!</em></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeDonationModal()">Maybe Later</button>
                <button class="btn btn-primary" onclick="proceedToDonate()" id="donate-btn">
                    <span class="label">Donate $5</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Processing...</div>
            <button class="btn btn-danger btn-sm" onclick="cancelOneClickGeneration()" id="cancel-btn" style="display: none;">
                <span class="label">Cancel</span>
            </button>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="projects-import-file" style="display: none;" accept=".json" onchange="handleProjectsImport(event)">

    <script src="script.js"></script>
</body>
</html>