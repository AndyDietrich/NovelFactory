<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelFactory AI - Create Complete Books with AI | Professional Book Generator</title>
    <meta name="description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction with our advanced AI book generator. Try NovelFactory AI free today!">
    <meta name="keywords" content="AI book generator, novel writing AI, story generator, book creator, AI author, fiction generator, novel factory, AI writing tool, automated book creation">
    <meta name="author" content="NovelFactory AI">
    <meta name="robots" content="index, follow">

    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="NovelFactory AI - Create Complete Books with AI">
    <meta property="og:description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction with our advanced AI book generator.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://novelfactory.ink">
    <meta property="og:image" content="https://novelfactory.ink/og-image.jpg">
    <meta property="og:site_name" content="NovelFactory AI">

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NovelFactory AI - Create Complete Books with AI">
    <meta name="twitter:description" content="Generate complete professional books with AI. Create bestselling novels, stories, and fiction.">
    <meta name="twitter:image" content="https://novelfactory.ink/twitter-image.jpg">
    <meta name="twitter:site" content="@novelfactory">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://novelfactory.ink">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "NovelFactory AI",
        "description": "Professional AI-powered book generator for creating complete novels and stories",
        "url": "https://novelfactory.ink",
        "applicationCategory": "Writing Tool",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>

    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="favicon.ico" sizes="any"> <!-- fallback -->
	
</head>
<body data-theme="light">
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">NovelFactory AI</h1>
                    <p class="app-subtitle">Create complete books with the power of AI</p>
                </div>
                <div class="header-right">
                    <div class="theme-selector-container">
                        <select class="theme-selector" id="theme-select" onchange="changeTheme()">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="fun">Color</option>
                        </select>
                    </div>
                    <button class="header-btn" onclick="estimateCosts()">
                        <span class="label">Cost Estimate</span>
                    </button>
                    <button class="header-btn" onclick="showFeedbackForm()">
                        <span class="label">Feedback</span>
                    </button>
                    <button class="header-btn" onclick="showDonationModal()">
                        <span class="label">Donate</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Project Management -->
        <div class="project-bar">
            <div class="project-controls">
                <select id="project-select" class="project-selector" onchange="switchProject()">
                    <option value="current">Current Project</option>
                </select>
                <div class="project-actions">
                    <button class="btn btn-ghost btn-sm" onclick="newProject()">
                        <span class="label">New</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="saveProject()">
                        <span class="label">Save</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" onclick="loadProject()">
                        <span class="label">Load</span>
                    </button>
                </div>
                <input type="file" id="project-file" style="display: none;" accept=".json" onchange="importProject(event)">
            </div>
        </div>

        <!-- Navigation -->
        <nav class="navigation">
            <div class="nav-progress">
                <div class="progress-line" id="nav-progress-line"></div>
            </div>
            <div class="nav-items">
                <button class="nav-item" onclick="showStep('settings')" data-step="settings">
                    <span class="nav-label">Settings</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item active" onclick="showStep('setup')" data-step="setup">
                    <span class="nav-label">Book Setup</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('outline')" data-step="outline">
                    <span class="nav-label">Story Structure</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('chapters')" data-step="chapters">
                       <span class="nav-label">Chapter Planning</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('writing')" data-step="writing">
                    <span class="nav-label">Writing</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('export')" data-step="export">
                    <span class="nav-label">Export</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('analytics')" data-step="analytics">
                    <span class="nav-label">Analytics</span>
                    <span class="nav-status"></span>
                </button>
                <button class="nav-item" onclick="showStep('tutorial')" data-step="tutorial">
                    <span class="nav-label">Tutorial</span>
                    <span class="nav-status"></span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Setup Step -->
            <div id="setup" class="step active">
                <div class="step-header">
                    <h2 class="step-title">Book Setup</h2>
                    <p class="step-description">Define the foundation of your book by filling in the details below</p>
                </div>

                <div class="step-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="genre">Genre</label>
                            <select id="genre" onchange="updateGenreRequirements()">
                                <option value="">Select a genre...</option>
                                <option value="fantasy">Fantasy</option>
                                <option value="science-fiction">Science Fiction</option>
                                <option value="mystery">Mystery</option>
                                <option value="romance">Romance</option>
                                <option value="thriller">Thriller</option>
                                <option value="horror">Horror</option>
                                <option value="adventure">Adventure</option>
                                <option value="literary-fiction">Literary Fiction</option>
                                <option value="historical-fiction">Historical Fiction</option>
                                <option value="young-adult">Young Adult</option>
                                <option value="children">Children's</option>
                                <option value="non-fiction">Non-Fiction</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="target-audience">Target Audience</label>
                            <select id="target-audience" onchange="updateAudienceRequirements()">
                                <option value="">Select target audience...</option>
                                <option value="children-5-8">Children (5-8 years)</option>
                                <option value="children-9-12">Children (9-12 years)</option>
                                <option value="young-adult">Young Adult (13-17 years)</option>
                                <option value="new-adult">New Adult (18-25 years)</option>
                                <option value="adult">Adult (25+ years)</option>
                                <option value="general">General Audience</option>
                            </select>
                        </div>
                    </div>

                    <div id="genre-requirements" class="info-card" style="display: none;">
                        <h4>Genre-Specific Requirements</h4>
                        <div id="genre-requirements-content"></div>
                    </div>

                    <div class="form-group">
                        <label for="premise">Premise</label>
                        <div class="textarea-container">
                            <textarea id="premise" placeholder="What is your book about? Describe the main concept, conflict, or journey..." oninput="autoSave(); updateWordCount();"></textarea>
                            <div class="word-count" id="premise-word-count">0 words</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="style-direction">Style Direction</label>
                        <div class="textarea-container">
                            <textarea id="style-direction" placeholder="Describe the writing style you want (e.g., humorous, dark, poetic, fast-paced, descriptive...)" oninput="autoSave(); updateWordCount();"></textarea>
                            <div class="word-count" id="style-word-count">0 words</div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="num-chapters">Number of Chapters</label>
                            <input type="number" id="num-chapters" min="5" max="50" value="40" oninput="updateChapterEstimate()">
                            <div class="form-hint" id="chapter-estimate">Estimated book length: ~80,000 words</div>
                        </div>

                        <div class="form-group">
                            <label for="target-word-count">Target Words per Chapter</label>
                            <input type="number" id="target-word-count" min="1000" max="8000" value="2000">
                            <div class="form-hint">Recommended: 2000-4000 for most genres</div>
                        </div>
                    </div>

                    <div class="random-idea-section">
                        <button class="btn btn-secondary" onclick="generateRandomIdea()" id="random-idea-btn" style="display: none;">
                            <span class="label">Generate Random Idea</span>
                        </button>
                        <p class="random-idea-hint">Select genre and target audience first, then generate a random book idea!</p>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-primary" onclick="startBookGeneration()">
                            <span class="label">Next: Story Structure</span>
                        </button>
                        <button class="btn btn-secondary" onclick="startOneClickGeneration()">
                            <span class="label">1-Click Generation</span>
                        </button>
                        <button class="btn btn-danger" onclick="resetEverything()">
                            <span class="label">Reset & Start New</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Story Structure Step -->
            <div id="outline" class="step">
                <div class="step-header">
                    <h2 class="step-title">Story Structure & Characters</h2>
                    <p class="step-description">AI-generated story structure with integrated character development</p>
                </div>

                <div class="step-content">
                    <div class="feedback-controls">
                        <div class="feedback-header">
                            <h3>Quality Enhancement</h3>
                            <div class="feedback-options">
                                <label>
                                    <span>Feedback Mode:</span>
                                    <select id="outline-feedback-mode">
                                        <option value="ai">AI Analysis</option>
                                        <option value="manual">Manual Feedback</option>
                                    </select>
                                </label>
                                <label>
                                    <span>Feedback Loops:</span>
                                    <select id="outline-feedback-loops">
                                        <option value="0">No feedback</option>
                                        <option value="1">1 loop</option>
                                        <option value="2">2 loops</option>
                                        <option value="3">3 loops</option>
                                        <option value="5">5 loops</option>
                                    </select>
                                </label>
                                <div class="feedback-buttons">
                                    <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('outline')">
                                        <span class="label">Run Feedback Loop</span>
                                    </button>
                                    <div class="dropdown">
                                        <button class="btn btn-ghost btn-sm dropdown-toggle" onclick="toggleFeedbackPromptEditor('outline')">
                                            <span class="label">Edit Prompt</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="outline-manual-feedback" class="manual-feedback-section" style="display: none;">
                            <label for="outline-manual-input">Manual Feedback Instructions:</label>
                            <textarea id="outline-manual-input" placeholder="Describe what you'd like to improve or change about the story structure..." rows="4"></textarea>
                        </div>
                        <div id="outline-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                            <label for="outline-feedback-prompt">Feedback Analysis Prompt:</label>
                            <textarea id="outline-feedback-prompt" rows="6"></textarea>
                            <div class="prompt-actions">
                                <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('outline')">Reset to Default</button>
                                <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('outline')">Save Changes</button>
                            </div>
                        </div>
                    </div>

                    <div class="prompt-editor">
                        <label for="outline-prompt">Story Structure Generation Prompt</label>
                        <textarea id="outline-prompt" class="prompt-textarea"></textarea>
                        <button class="btn btn-ghost btn-sm" onclick="regenerateOutline()">
                            <span class="label">Regenerate Structure</span>
                        </button>
                    </div>

                    <div class="output-section">
                        <div id="outline-output">Click "Generate Story Structure" to create your complete narrative framework...</div>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-primary" onclick="generateOutline()">
                            <span class="label">Generate Story Structure</span>
                        </button>
                        <button class="btn btn-success" onclick="proceedToChapters()" style="display: none;" id="outline-next">
                            <span class="label">Next: Chapter Planning</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chapter Planning Step -->
            <div id="chapters" class="step">
                <div class="step-header">
                    <h2 class="step-title">Chapter Planning</h2>
                    <p class="step-description">Detailed chapter-by-chapter breakdown and summaries</p>
                </div>

                <div class="step-content">
                    <div class="feedback-controls">
                        <div class="feedback-header">
                            <h3>Quality Enhancement</h3>
                            <div class="feedback-options">
                                <label>
                                    <span>Feedback Mode:</span>
                                    <select id="chapters-feedback-mode">
                                        <option value="ai">AI Analysis</option>
                                        <option value="manual">Manual Feedback</option>
                                    </select>
                                </label>
                                <label>
                                    <span>Feedback Loops:</span>
                                    <select id="chapters-feedback-loops">
                                        <option value="0">No feedback</option>
                                        <option value="1">1 loop</option>
                                        <option value="2">2 loops</option>
                                        <option value="3">3 loops</option>
                                        <option value="5">5 loops</option>
                                    </select>
                                </label>
                                <div class="feedback-buttons">
                                    <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('chapters')">
                                        <span class="label">Run Feedback Loop</span>
                                    </button>
                                    <div class="dropdown">
                                        <button class="btn btn-ghost btn-sm dropdown-toggle" onclick="toggleFeedbackPromptEditor('chapters')">
                                            <span class="label">Edit Prompt</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="chapters-manual-feedback" class="manual-feedback-section" style="display: none;">
                            <label for="chapters-manual-input">Manual Feedback Instructions:</label>
                            <textarea id="chapters-manual-input" placeholder="Describe what you'd like to improve or change about the chapter planning..." rows="4"></textarea>
                        </div>
                        <div id="chapters-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                            <label for="chapters-feedback-prompt">Feedback Analysis Prompt:</label>
                            <textarea id="chapters-feedback-prompt" rows="6"></textarea>
                            <div class="prompt-actions">
                                <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('chapters')">Reset to Default</button>
                                <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('chapters')">Save Changes</button>
                            </div>
                        </div>
                    </div>

                    <div class="prompt-editor">
                        <label for="chapters-prompt">Chapter Planning Prompt</label>
                        <textarea id="chapters-prompt" class="prompt-textarea"></textarea>
                        <button class="btn btn-ghost btn-sm" onclick="regenerateChapterOutline()">
                            <span class="label">Regenerate Chapter Plan</span>
                        </button>
                    </div>

                    <div class="output-section">
                        <div id="chapters-output">Chapter planning will be generated...</div>
                    </div>

                    <div class="step-actions">
                        <button class="btn btn-primary" onclick="generateChapterOutline()">
                            <span class="label">Generate Chapter Plan</span>
                        </button>
                        <button class="btn btn-success" onclick="proceedToWriting()" style="display: none;" id="chapters-next">
                            <span class="label">Next: Writing</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Writing Step -->
            <div id="writing" class="step">
                <div class="step-header">
                    <h2 class="step-title">Writing Chapters</h2>
                    <p class="step-description">Generate the full prose for each chapter with professional quality</p>
                </div>

                <div class="step-content">
                    <div class="feedback-controls">
                        <div class="feedback-header">
                            <h3>Quality Enhancement</h3>
                            <div class="feedback-options">
                                <label>
                                    <span>Feedback Mode:</span>
                                    <select id="writing-feedback-mode">
                                        <option value="ai">AI Analysis</option>
                                        <option value="manual">Manual Feedback</option>
                                    </select>
                                </label>
                                <label>
                                    <span>Feedback Loops:</span>
                                    <select id="writing-feedback-loops">
                                        <option value="0">No feedback</option>
                                        <option value="1">1 loop</option>
                                        <option value="2">2 loops</option>
                                        <option value="3">3 loops</option>
                                        <option value="5">5 loops</option>
                                    </select>
                                </label>
                                <div class="feedback-buttons">
                                    <button class="btn btn-ghost btn-sm" onclick="runFeedbackLoop('writing')">
                                        <span class="label">Run Feedback Loop</span>
                                    </button>
                                    <div class="dropdown">
                                        <button class="btn btn-ghost btn-sm dropdown-toggle" onclick="toggleFeedbackPromptEditor('writing')">
                                            <span class="label">Edit Prompt</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="writing-manual-feedback" class="manual-feedback-section" style="display: none;">
                            <label for="writing-manual-input">Manual Feedback Instructions:</label>
                            <textarea id="writing-manual-input" placeholder="Describe what you'd like to improve or change about the writing..." rows="4"></textarea>
                        </div>
                        <div id="writing-feedback-prompt-editor" class="feedback-prompt-editor" style="display: none;">
                            <label for="writing-feedback-prompt">Feedback Analysis Prompt:</label>
                            <textarea id="writing-feedback-prompt" rows="6"></textarea>
                            <div class="prompt-actions">
                                <button class="btn btn-ghost btn-sm" onclick="resetFeedbackPrompt('writing')">Reset to Default</button>
                                <button class="btn btn-success btn-sm" onclick="saveFeedbackPrompt('writing')">Save Changes</button>
                            </div>
                        </div>
                    </div>

                    <div class="prompt-editor">
                        <label for="writing-prompt">Chapter Writing Prompt</label>
                        <textarea id="writing-prompt" class="prompt-textarea"></textarea>
                    </div>

                    <div class="progress-section">
                        <div class="progress-bar">
                            <div id="writing-progress" class="progress-fill"></div>
                        </div>
                        <div id="writing-status">Ready to begin writing chapters...</div>
                    </div>

                    <div id="chapters-container"></div>

                    <div class="writing-footer">
                        <p class="writing-hint">Tip: Use the controls above each chapter list to generate chapters individually or in batches</p>
                        <button class="btn btn-success" onclick="proceedToExport()" style="display: none;" id="writing-next">
                            <span class="label">Next: Export</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Export Step -->
            <div id="export" class="step">
                <div class="step-header">
                    <h2 class="step-title">Export Your Book</h2>
                    <p class="step-description">Download your completed book in multiple professional formats</p>
                </div>

                <div class="step-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-words">0</div>
                            <div class="stat-label">Total Words</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-chapters">0</div>
                            <div class="stat-label">Chapters</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avg-words">0</div>
                            <div class="stat-label">Avg Words/Chapter</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="reading-time">0</div>
                            <div class="stat-label">Reading Time (min)</div>
                        </div>
                    </div>

                    <div class="export-grid">
                        <div class="export-card">
                            <div class="export-icon">TXT</div>
                            <h4>Text Format</h4>
                            <p>Simple text file for basic reading</p>
                            <button class="btn btn-primary" onclick="downloadBook('txt')">Download TXT</button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">HTML</div>
                            <h4>HTML Format</h4>
                            <p>Web-ready format with styling</p>
                            <button class="btn btn-primary" onclick="downloadBook('html')">Download HTML</button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">MD</div>
                            <h4>Markdown Format</h4>
                            <p>Universal format for publishing platforms</p>
                            <button class="btn btn-primary" onclick="downloadBook('md')">Download Markdown</button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">COPY</div>
                            <h4>Copy to Clipboard</h4>
                            <p>Quick copy for pasting elsewhere</p>
                            <button class="btn btn-primary" onclick="copyToClipboard()">Copy Text</button>
                        </div>
                    </div>

                    <div class="output-section">
                        <h3>Book Quality Analysis</h3>
                        <div id="quality-analysis">Complete the writing process to see quality analysis...</div>
                    </div>
                </div>
            </div>

            <!-- Settings Step -->
            <div id="settings" class="step">
                <div class="step-header">
                    <h2 class="step-title">AI Settings & Prompts</h2>
                    <p class="step-description">Configure your AI settings and customize all generation prompts</p>
                </div>

                <div class="step-content">
                    <div class="settings-section">
                        <h3>API Configuration</h3>
                        <div class="api-provider-toggle">
                            <div class="toggle-group">
                                <button class="toggle-btn active" onclick="switchApiProvider('openrouter')" id="openrouter-btn">
                                    OpenRouter
                                </button>
                                <button class="toggle-btn" onclick="switchApiProvider('openai')" id="openai-btn">
                                    OpenAI
                                </button>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group" id="openrouter-key-group">
                                <label for="openrouter-api-key">OpenRouter API Key</label>
                                <input type="password" id="openrouter-api-key" placeholder="Enter your OpenRouter API key..." onchange="saveSettings(); updateModelSelect()">
                                <div class="form-hint">Get your API key from <a href="https://openrouter.ai" target="_blank">openrouter.ai</a></div>
                            </div>

                            <div class="form-group" id="openai-key-group" style="display: none;">
                                <label for="openai-api-key">OpenAI API Key</label>
                                <input type="password" id="openai-api-key" placeholder="Enter your OpenAI API key..." onchange="saveSettings(); updateModelSelect()">
                                <div class="form-hint">Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></div>
                            </div>

                            <div class="form-group">
                                <label for="model-select">AI Model</label>
                                <select id="model-select" onchange="updateModelInfo()">
                                    <!-- Models will be populated by JavaScript -->
                                </select>
                                <div id="model-cost-info" class="form-hint">Best quality models marked with stars | Budget models marked with dollar signs</div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="temperature">Temperature (Creativity): <span id="temp-value">0.5</span></label>
                                <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.5" oninput="updateTempValue()">
                                <div class="form-hint">Higher = more creative, Lower = more focused</div>
                            </div>

                            <div class="form-group">
                                <label for="max-tokens">Max Tokens per Request</label>
                                <input type="number" id="max-tokens" min="1000" max="1000000" value="50000">
                                <div class="form-hint">Maximum length of each AI response</div>
                            </div>
                        </div>

                        <div class="settings-actions">
                            <button class="btn btn-primary" onclick="testApiConnection()">
                                <span class="label">Test Connection</span>
                            </button>
                            <button class="btn btn-ghost" onclick="resetPrompts()">
                                <span class="label">Reset Prompts</span>
                            </button>
                            <button class="btn btn-ghost" onclick="exportSettings()">
                                <span class="label">Export Settings</span>
                            </button>
                            <button class="btn btn-ghost" onclick="importSettings()">
                                <span class="label">Import Settings</span>
                            </button>
                        </div>

                        <div id="api-status"></div>
                    </div>
                </div>
            </div>

            <!-- Analytics Step -->
            <div id="analytics" class="step">
                <div class="step-header">
                    <h2 class="step-title">Writing Analytics</h2>
                    <p class="step-description">Detailed analysis of your book's structure, pacing, and quality</p>
                </div>

                <div class="step-content">
                    <div class="stats-grid">
                        <div class="stat-card" title="Flesch-Kincaid reading grade level. Lower scores indicate easier reading. Ideal range: 6-12 for most audiences.">
                            <div class="stat-number" id="readability-score">N/A</div>
                            <div class="stat-label">Readability Grade</div>
                            <div class="stat-explanation" id="readability-explanation">Measures reading difficulty</div>
                        </div>
                        <div class="stat-card" title="Percentage of text that is dialogue. Good fiction typically has 20-40% dialogue for engaging storytelling.">
                            <div class="stat-number" id="dialogue-ratio">N/A</div>
                            <div class="stat-label">Dialogue %</div>
                            <div class="stat-explanation" id="dialogue-explanation">Shows character interaction</div>
                        </div>
                        <div class="stat-card" title="How well chapter lengths match your target. 10/10 means perfect consistency. Lower scores suggest uneven pacing.">
                            <div class="stat-number" id="pacing-score">N/A</div>
                            <div class="stat-label">Pacing Score</div>
                            <div class="stat-explanation" id="pacing-explanation">Chapter length consistency</div>
                        </div>
                        <div class="stat-card" title="Percentage of chapters completed. 100% means your book is ready for export and publishing.">
                            <div class="stat-number" id="completion-rate">0%</div>
                            <div class="stat-label">Completion</div>
                            <div class="stat-explanation" id="completion-explanation">Book progress status</div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="output-section">
                            <h3>Chapter Balance Analysis</h3>
                            <div id="chapter-balance">Generate some chapters to see balance analysis...</div>
                        </div>

                        <div class="output-section">
                            <h3>Content Analysis</h3>
                            <div id="content-analysis">Complete writing to see detailed content analysis...</div>
                        </div>
                    </div>

                    <div class="analytics-actions">
                        <button class="btn btn-primary" onclick="generateAnalytics()">
                            <span class="label">Refresh Analytics</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tutorial Step -->
            <div id="tutorial" class="step">
                <div class="step-header">
                    <h2 class="step-title">Tutorial & Guide</h2>
                    <p class="step-description">Complete guide to using NovelFactory AI effectively</p>
                </div>

                <div class="step-content">
                    <div class="tutorial-section">
                        <h3>Getting Started</h3>

                        <div class="tutorial-card">
                            <h4>1. AI Settings</h4>
                            <p>Connect & customize AI behavior and output:</p>
                            <ul>
                                <li><strong>API Providers:</strong> Enter your OpenRouter and/or OpenAI API key</li>
                                <li><strong>Model Selection:</strong> Pick from various AI models for different needs</li>
                                <li><strong>Temperature:</strong> Control creativity vs. consistency (0-1)</li>
                                <li><strong>Custom Prompts:</strong> Modify generation prompts for specific results</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>2. Book Setup</h4>
                            <p>Start by selecting your <strong>genre</strong> and <strong>target audience</strong>. This helps the AI understand the style and conventions your book should follow.</p>
                            <ul>
                                <li><strong>Premise:</strong> Describe your book's main concept, conflict, or journey in 2-3 sentences</li>
                                <li><strong>Style Direction:</strong> Specify the writing style (humorous, dark, poetic, etc.)</li>
                                <li><strong>Chapter Count:</strong> Choose between 5-50 chapters based on your desired book length</li>
                                <li><strong>Words per Chapter:</strong> Set target length (2000-4000 words recommended)</li>
                            </ul>
                            <p><strong>Pro Tip:</strong> Use the "Generate Random Idea" button for inspiration!</p>
                        </div>

                        <div class="tutorial-card">
                            <h4>3. Story Structure</h4>
                            <p>The AI creates a complete narrative framework following proven storytelling formulas:</p>
                            <ul>
                                <li><strong>Three-Act Structure:</strong> Setup, confrontation, and resolution</li>
                                <li><strong>Character Development:</strong> Protagonist, antagonist, and supporting characters</li>
                                <li><strong>Plot Points:</strong> Key moments and turning points</li>
                                <li><strong>Pacing Guidelines:</strong> Tension management and emotional beats</li>
                            </ul>
                            <p><strong>Quality Enhancement:</strong> Use feedback loops to refine the structure</p>
                        </div>

                        <div class="tutorial-card">
                            <h4>4. Chapter Planning</h4>
                            <p>Detailed breakdown of each chapter with scene structure:</p>
                            <ul>
                                <li><strong>Chapter Titles:</strong> Compelling and genre-appropriate</li>
                                <li><strong>Scene Structure:</strong> Opening hooks, plot beats, character moments</li>
                                <li><strong>Continuity Notes:</strong> Maintains consistency across chapters</li>
                                <li><strong>Book Title & Blurb:</strong> Automatically generated marketing copy</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>5. Writing Process</h4>
                            <p>Generate high-quality prose for each chapter:</p>
                            <ul>
                                <li><strong>Individual Generation:</strong> Write chapters one at a time for control</li>
                                <li><strong>Batch Processing:</strong> Select multiple chapters for faster generation</li>
                                <li><strong>Expand Mode:</strong> Full-screen writing environment for editing</li>
                                <li><strong>Chapter Feedback:</strong> Improve individual chapters with AI analysis</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Advanced Features</h3>
                        <div class="tutorial-card">
                            <h4>Feedback Loop System</h4>
                            <p>Enhance quality through iterative improvement:</p>
                            <ul>
                                <li><strong>AI Analysis:</strong> Automated quality assessment and improvement</li>
                                <li><strong>Manual Feedback:</strong> Provide specific instructions for changes</li>
                                <li><strong>Multiple Loops:</strong> Run 1-5 feedback cycles for maximum quality</li>
                                <li><strong>Custom Prompts:</strong> Edit analysis prompts for specific needs</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>One-Click Generation</h4>
                            <p>Fully automated book creation:</p>
                            <ul>
                                <li>Configure feedback loops for each step</li>
                                <li>AI handles the entire process automatically</li>
                                <li>Generates complete book from setup to export</li>
                                <li>Perfect for rapid prototyping or first drafts</li>
                            </ul>
                        </div>

                    </div>

                    <div class="tutorial-section">
                        <h3>Analytics & Export</h3>
                        <div class="tutorial-card">
                            <h4>Writing Analytics</h4>
                            <p>Analyze your book's quality and structure:</p>
                            <ul>
                                <li><strong>Readability Score:</strong> Flesch-Kincaid grade level analysis</li>
                                <li><strong>Dialogue Ratio:</strong> Balance of dialogue vs. narrative</li>
                                <li><strong>Pacing Score:</strong> Chapter length consistency</li>
                                <li><strong>Content Analysis:</strong> Word frequency and structure metrics</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Export Options</h4>
                            <p>Download your book in multiple formats:</p>
                            <ul>
                                <li><strong>TXT:</strong> Plain text for basic reading</li>
                                <li><strong>HTML:</strong> Web-ready format with styling</li>
                                <li><strong>Markdown:</strong> Universal format for publishing platforms</li>
                                <li><strong>Copy to Clipboard:</strong> Quick sharing and pasting</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Tips & Best Practices</h3>
                        <div class="tutorial-card">
                            <h4>Writing Quality</h4>
                            <ul>
                                <li>Use feedback loops liberally for better quality</li>
                                <li>Review and edit AI-generated content</li>
                                <li>Maintain consistency in character voices</li>
                                <li>Use genre-specific requirements as guidelines</li>
                                <li>Export regularly to backup your work</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Project Management</h4>
                            <ul>
                                <li>Save projects regularly with descriptive names</li>
                                <li>Export settings to share configurations</li>
                                <li>Use auto-save feature (runs every 30 seconds)</li>
                                <li>Load previous projects to continue work</li>
                                <li>Reset to start completely fresh</li>
                            </ul>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>Troubleshooting</h3>
                        <div class="tutorial-card">
                            <h4>Common Issues</h4>
                            <ul>
                                <li><strong>API Errors:</strong> Check your API key and internet connection</li>
                                <li><strong>Slow Generation:</strong> Reduce max tokens or use a faster model</li>
                                <li><strong>Quality Issues:</strong> Use more feedback loops or manual feedback</li>
                                <li><strong>Inconsistent Style:</strong> Review and refine your style direction</li>
                                <li><strong>Lost Work:</strong> Check auto-save in browser storage</li>
                            </ul>
                        </div>

                        <div class="tutorial-card">
                            <h4>Getting Help</h4>
                            <p>Need more assistance? Here's how to get help:</p>
                            <ul>
                                <li>Use the <strong>Feedback</strong> button in the header to report issues</li>
                                <li>Test your API connection in Settings</li>
                                <li>Export your settings and project for troubleshooting</li>
                                <li>Check the cost estimator for API usage planning</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Auto-save Indicator -->
    <div id="auto-save-indicator" class="auto-save-indicator">Auto-saved</div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="modal custom-alert-modal">
        <div class="modal-content alert-content">
            <div class="alert-header">
                <h3 id="alert-title">Notification</h3>
            </div>
            <div class="alert-body">
                <div id="alert-message">Alert message will appear here</div>
            </div>
            <div class="alert-footer">
                <button class="btn btn-primary" id="alert-ok-btn" onclick="closeCustomAlert()">OK</button>
                <button class="btn btn-ghost" id="alert-cancel-btn" onclick="closeCustomAlert(false)" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Expand Modal -->
    <div id="expand-modal" class="expand-modal">
        <div class="expand-header">
            <div class="expand-title">
                <h3 id="expand-chapter-title">Chapter 1 - Expanded View</h3>
                <div class="expand-info">
                    <span id="expand-word-count">0 words</span>
                    <span id="expand-reading-time">0 min read</span>
                </div>
            </div>
            <div class="expand-controls">
                <button class="btn btn-ghost btn-sm" onclick="toggleExpandedReadMode()">
                    <span id="read-mode-label">Read Mode</span>
                </button>
                <button class="btn btn-success btn-sm" onclick="saveExpandedChapter()">
                    <span class="label">Save Changes</span>
                </button>
                <button class="btn btn-danger btn-sm" onclick="closeExpandModal()">
                    <span class="label">Close</span>
                </button>
            </div>
        </div>
        <div class="expand-content">
            <div class="expand-editor" id="expand-editor">
                <textarea id="expand-textarea" placeholder="Chapter content..."></textarea>
            </div>
            <div class="expand-reader" id="expand-reader" style="display: none;">
                <div id="expand-reader-content"></div>
            </div>
        </div>
    </div>

    <!-- One-Click Generation Modal -->
    <div id="one-click-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>1-Click Generation Configuration</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeOneClickModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Configure feedback loops for each generation step:</p>
                
                <div class="one-click-config">
                    <div class="config-row">
                        <label>Story Structure Feedback Loops:</label>
                        <select id="one-click-outline-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label>Chapter Planning Feedback Loops:</label>
                        <select id="one-click-chapters-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                    <div class="config-row">
                        <label>Writing Feedback Loops:</label>
                        <select id="one-click-writing-loops">
                            <option value="0">No feedback</option>
                            <option value="1">1 loop</option>
                            <option value="2">2 loops</option>
                            <option value="3">3 loops</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeOneClickModal()">Cancel</button>
                <button class="btn btn-primary" onclick="startOneClickProcess()">
                    <span class="label">Start Generation</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Feedback</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeFeedbackModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="feedback-type">Feedback Type</label>
                    <select id="feedback-type">
                        <option value="bug">Bug Report</option>
                        <option value="feature">Feature Request</option>
                        <option value="improvement">Improvement Suggestion</option>
                        <option value="question">Question</option>
                        <option value="praise">Compliment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedback-message">Your Feedback</label>
                    <textarea id="feedback-message" rows="6" placeholder="Please describe your feedback in detail..."></textarea>
                </div>
                <div class="form-group">
                    <label for="feedback-email">Email (optional)</label>
                    <input type="email" id="feedback-email" placeholder="your@email.com">
                    <div class="form-hint">Leave your email if you'd like a response</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitFeedback()">
                    <span class="label">Send Feedback</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Donation Modal -->
    <div id="donation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Support NovelFactory AI</h3>
                <button class="btn btn-ghost btn-sm" onclick="closeDonationModal()">
                    <span class="label">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="donation-content">
                    <p><strong>NovelFactory AI is completely free to use!</strong></p>
                    <p>If you find this tool helpful and would like to support its development, consider buying me a coffee. Your support helps me:</p>
                    <ul>
                        <li>Keep the service free for everyone</li>
                        <li>Add new features and improvements</li>
                        <li>Maintain and improve the platform</li>
                        <li>Create better AI writing tools</li>
                    </ul>
                    
                    <div class="donation-options">
                        <h4>Choose an amount:</h4>
                        <div class="donation-buttons">
                            <button class="btn btn-ghost donation-amount" onclick="setDonationAmount(5)">
                                <span class="label">$5 Coffee</span>
                            </button>
                            <button class="btn btn-ghost donation-amount" onclick="setDonationAmount(10)">
                                <span class="label">$10 Meal</span>
                            </button>
                            <button class="btn btn-ghost donation-amount" onclick="setDonationAmount(25)">
                                <span class="label">$25 Generous</span>
                            </button>
                        </div>
                        
                        <div class="custom-amount">
                            <label>Or enter custom amount (USD):</label>
                            <input type="number" id="custom-donation-amount" min="1" placeholder="Enter amount">
                        </div>
                    </div>
                    
                    <p class="donation-note"><em>Every contribution, no matter how small, means the world to us!</em></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeDonationModal()">Maybe Later</button>
                <button class="btn btn-primary" onclick="proceedToDonate()" id="donate-btn">
                    <span class="label">Donate $5</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Processing...</div>
            <button class="btn btn-danger btn-sm" onclick="cancelOneClickGeneration()" id="cancel-btn" style="display: none;">
                <span class="label">Cancel</span>
            </button>
        </div>
    </div>

    <script src="script.js"></script>

    <style>
/* Apple-Inspired Design System with Fun Theme */
:root {
    /* Colors - Light Theme */
    --color-primary: #007AFF;
    --color-primary-hover: #0056CC;
    --color-success: #34C759;
    --color-danger: #FF3B30;
    --color-warning: #FF9500;
    --color-secondary: #8E8E93;
    
    /* Backgrounds */
    --bg-primary: #FFFFFF;
    --bg-secondary: #F2F2F7;
    --bg-tertiary: #FFFFFF;
    --bg-quaternary: #F2F2F7;
    
    /* Text Colors */
    --text-primary: #000000;
    --text-secondary: #3C3C43;
    --text-tertiary: #3C3C4399;
    --text-quaternary: #3C3C4360;
    
    /* Borders & Separators */
    --separator: #3C3C4329;
    --border-primary: #D1D1D6;
    --border-secondary: #E5E5EA;
    
    /* Shadows */
    --shadow-small: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.15);
    --shadow-large: 0 8px 30px rgba(0, 0, 0, 0.12);
    
    /* Blur Effects */
    --blur-light: rgba(255, 255, 255, 0.8);
    --blur-dark: rgba(0, 0, 0, 0.3);
    
    /* Spacing */
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --spacing-2xl: 48px;
    
    /* Border Radius */
    --radius-sm: 6px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 20px;
    
    /* Typography */
    --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-size-xs: 11px;
    --font-size-sm: 13px;
    --font-size-base: 15px;
    --font-size-lg: 17px;
    --font-size-xl: 19px;
    --font-size-2xl: 22px;
    --font-size-3xl: 28px;
    --font-size-4xl: 36px;
    
    /* Transitions */
    --transition-fast: 0.2s ease;
    --transition-medium: 0.3s ease;
    --transition-slow: 0.5s ease;
}

/* Dark Theme */
[data-theme="dark"] {
    --color-primary: #0A84FF;
    --color-primary-hover: #409CFF;
    --color-success: #30D158;
    --color-danger: #FF453A;
    --color-warning: #FF9F0A;
    --color-secondary: #98989D;
    
    --bg-primary: #000000;
    --bg-secondary: #1C1C1E;
    --bg-tertiary: #2C2C2E;
    --bg-quaternary: #3A3A3C;
    
    --text-primary: #FFFFFF;
    --text-secondary: #EBEBF5;
    --text-tertiary: #EBEBF599;
    --text-quaternary: #EBEBF560;
    
    --separator: #54545899;
    --border-primary: #38383A;
    --border-secondary: #48484A;
    
    --blur-light: rgba(0, 0, 0, 0.8);
    --blur-dark: rgba(255, 255, 255, 0.1);
}

/* Fun Theme */
[data-theme="fun"] {
    --color-primary: #FF6B6B;
    --color-primary-hover: #FF5252;
    --color-success: #4ECDC4;
    --color-danger: #FF8A80;
    --color-warning: #FFD54F;
    --color-secondary: #9C27B0;
    
    --bg-primary: #FFF8E1;
    --bg-secondary: #F3E5F5;
    --bg-tertiary: #E1F5FE;
    --bg-quaternary: #FCE4EC;
    
    --text-primary: #2E2E2E;
    --text-secondary: #5E35B1;
    --text-tertiary: #7986CB;
    --text-quaternary: #9575CD;
    
    --separator: #E1BEE7;
    --border-primary: #F8BBD9;
    --border-secondary: #C8E6C9;
    
    --shadow-small: 0 1px 3px rgba(156, 39, 176, 0.2);
    --shadow-medium: 0 4px 12px rgba(255, 107, 107, 0.3);
    --shadow-large: 0 8px 30px rgba(78, 205, 196, 0.2);
    
    --blur-light: rgba(255, 248, 225, 0.9);
    --blur-dark: rgba(156, 39, 176, 0.1);
}

/* Theme Selector Dropdown */
.theme-selector-container {
    display: flex;
    align-items: center;
}

.theme-selector {
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    min-width: 100px;
}

.theme-selector:hover {
    background: var(--bg-quaternary);
    border-color: var(--border-primary);
    color: var(--text-primary);
}

.theme-selector:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

/* Responsive adjustment */
@media (max-width: 768px) {
    .theme-selector {
        min-width: 80px;
        font-size: var(--font-size-xs);
    }
}

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    font-size: 16px;
    line-height: 1.5;
}

body {
    font-family: var(--font-family);
    font-size: var(--font-size-base);
    color: var(--text-primary);
    background-color: var(--bg-secondary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: background-color var(--transition-medium), color var(--transition-medium);
}

/* App Container */
.app-container {
    min-height: 100vh;
    max-width: 1200px;
    margin: 0 auto;
    background-color: var(--bg-primary);
    box-shadow: var(--shadow-large);
    position: relative;
}

/* Header */
.header {
    background: var(--blur-light);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--separator);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg) var(--spacing-xl);
}

.header-left {
    flex: 1;
}

.app-title {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
}

.app-subtitle {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    font-weight: 400;
}

.header-right {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.header-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
}

.header-btn:hover {
    background: var(--bg-quaternary);
    border-color: var(--border-primary);
    color: var(--text-primary);
    transform: translateY(-1px);
}

/* Project Bar */
.project-bar {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--separator);
    padding: var(--spacing-md) var(--spacing-xl);
}

.project-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.project-selector {
    flex: 1;
    max-width: 300px;
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-primary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    font-weight: 500;
}

.project-actions {
    display: flex;
    gap: var(--spacing-sm);
}

/* Navigation */
.navigation {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--separator);
    position: relative;
}

.nav-progress {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--bg-secondary);
}

.progress-line {
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary), var(--color-success));
    width: 0%;
    transition: width var(--transition-medium);
}

.nav-items {
    display: flex;
    padding: 0 var(--spacing-xl);
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.nav-items::-webkit-scrollbar {
    display: none;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-md) var(--spacing-sm);
    background: none;
    border: none;
    cursor: pointer;
    position: relative;
    min-width: 80px;
    transition: all var(--transition-fast);
    color: var(--text-secondary);
}

.nav-item:hover {
    color: var(--text-primary);
    background: var(--bg-secondary);
}

.nav-item.active {
    color: var(--color-primary);
}

.nav-item.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 2px;
    background: var(--color-primary);
    border-radius: var(--radius-sm);
}

.nav-item.completed .nav-status::after {
    content: '';
    color: var(--color-success);
    font-weight: 600;
}

.nav-icon {
    font-size: var(--font-size-base);
    opacity: 0.8;
}

.nav-label {
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-align: center;
}

/* Main Content */
.main-content {
    padding: var(--spacing-2xl) var(--spacing-xl);
    min-height: calc(100vh - 200px);
}

.step {
    display: none;
    animation: fadeInUp 0.4s ease-out;
}

.step.active {
    display: block;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-header {
    text-align: center;
    margin-bottom: var(--spacing-2xl);
}

.step-title {
    font-size: var(--font-size-3xl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.step-description {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
    font-weight: 400;
}

.step-content {
    max-width: 800px;
    margin: 0 auto;
}

/* Custom Alert Modal */
.custom-alert-modal {
    z-index: 9999;
}

.alert-content {
    max-width: 450px;
    width: 90%;
}

.alert-header {
    padding: var(--spacing-lg) var(--spacing-xl);
    border-bottom: 1px solid var(--separator);
    text-align: center;
}

.alert-header h3 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.alert-body {
    padding: var(--spacing-xl);
    text-align: center;
}

.alert-body #alert-message {
    font-size: var(--font-size-base);
    line-height: 1.6;
    color: var(--text-primary);
    white-space: pre-wrap;
}

.alert-footer {
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
    padding: var(--spacing-lg) var(--spacing-xl);
    border-top: 1px solid var(--separator);
}

.alert-footer .btn {
    min-width: 80px;
}

/* Form Elements */
.form-group {
    margin-bottom: var(--spacing-lg);
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
}

input, select, textarea {
    width: 100%;
    padding: var(--spacing-md);
    background: var(--bg-primary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: var(--font-size-base);
    font-family: inherit;
    transition: all var(--transition-fast);
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
}

textarea {
    resize: vertical;
    min-height: 120px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    line-height: 1.6;
}

.textarea-container {
    position: relative;
}

.word-count {
    position: absolute;
    top: var(--spacing-sm);
    right: var(--spacing-sm);
    background: var(--bg-secondary);
    color: var(--text-tertiary);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    font-weight: 500;
    pointer-events: none;
}

.form-hint {
    margin-top: var(--spacing-xs);
    font-size: var(--font-size-xs);
    color: var(--text-tertiary);
    line-height: 1.4;
}

.form-hint a {
    color: var(--color-primary);
    text-decoration: none;
}

.form-hint a:hover {
    text-decoration: underline;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-size: var(--font-size-base);
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;
    white-space: nowrap;
}

.btn:hover {
    background: var(--color-primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-medium);
}

.btn:active {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.btn-sm {
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: var(--font-size-sm);
}

.btn-ghost {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-secondary);
}

.btn-ghost:hover {
    background: var(--bg-quaternary);
    border-color: var(--border-primary);
}

.btn-secondary {
    background: var(--color-secondary);
}

.btn-secondary:hover {
    background: #7A7A85;
}

.btn-success {
    background: var(--color-success);
}

.btn-success:hover {
    background: #28A745;
}

.btn-danger {
    background: var(--color-danger);
}

.btn-danger:hover {
    background: #E6342A;
}

.label {
    font-size: inherit;
    font-weight: inherit;
}

/* Cards */
.info-card, .output-section {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
}

.info-card h4, .output-section h3 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

/* Tutorial Styles */
.tutorial-section {
    margin-bottom: var(--spacing-2xl);
}

.tutorial-section h3 {
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.tutorial-card {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    transition: all var(--transition-fast);
}

.tutorial-card:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-medium);
    transform: translateY(-1px);
}

.tutorial-card h4 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

.tutorial-card p {
    margin-bottom: var(--spacing-md);
    line-height: 1.6;
}

.tutorial-card ul {
    margin-left: var(--spacing-lg);
    margin-bottom: var(--spacing-md);
}

.tutorial-card li {
    margin-bottom: var(--spacing-xs);
    line-height: 1.5;
}

.tutorial-card strong {
    color: var(--color-primary);
}

/* Donation Modal Styles */
.donation-content {
    text-align: center;
}

.donation-content p {
    margin-bottom: var(--spacing-md);
    line-height: 1.6;
}

.donation-content ul {
    text-align: left;
    margin: var(--spacing-md) 0;
    padding-left: var(--spacing-lg);
}

.donation-content li {
    margin-bottom: var(--spacing-xs);
}

.donation-options {
    margin: var(--spacing-xl) 0;
}

.donation-options h4 {
    margin-bottom: var(--spacing-md);
    color: var(--text-primary);
}

.donation-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
}

.donation-amount {
    flex-direction: column;
    padding: var(--spacing-md);
    font-size: var(--font-size-sm);
    gap: var(--spacing-xs);
}

.donation-amount:hover {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

.donation-amount.selected {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
}

.custom-amount {
    margin-top: var(--spacing-lg);
}

.custom-amount label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-size-sm);
    font-weight: 600;
}

.custom-amount input {
    max-width: 200px;
    margin: 0 auto;
}

.donation-note {
    font-style: italic;
    color: var(--text-secondary);
    margin-top: var(--spacing-lg);
}

/* Random Idea Section */
.random-idea-section {
    text-align: center;
    padding: var(--spacing-xl);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    margin: var(--spacing-lg) 0;
}

.random-idea-hint {
    margin-top: var(--spacing-md);
    font-size: var(--font-size-sm);
    color: var(--text-tertiary);
}

/* Step Actions */
.step-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    margin-top: var(--spacing-2xl);
    flex-wrap: wrap;
}

/* Feedback Controls */
.feedback-controls {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-md);
}

.feedback-header h3 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
}

.feedback-options {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.feedback-options label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin: 0;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-secondary);
}

.feedback-options select {
    min-width: 120px;
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-sm);
}

.feedback-buttons {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

.dropdown {
    position: relative;
}

.dropdown-toggle::after {
    content: '';
    font-size: var(--font-size-xs);
    margin-left: var(--spacing-xs);
}

.manual-feedback-section {
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--separator);
}

.manual-feedback-section label {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.manual-feedback-section textarea {
    width: 100%;
    min-height: 100px;
    font-size: var(--font-size-sm);
    line-height: 1.6;
}

.feedback-prompt-editor {
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--separator);
}

.feedback-prompt-editor label {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.feedback-prompt-editor textarea {
    width: 100%;
    min-height: 150px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: var(--font-size-sm);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
}

.prompt-actions {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: flex-end;
}

/* Prompt Editor */
.prompt-editor {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
}

.prompt-editor label {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

.prompt-textarea {
    min-height: 200px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: var(--font-size-sm);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
}

/* Progress Section */
.progress-section {
    margin: var(--spacing-lg) 0;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
    overflow: hidden;
    margin-bottom: var(--spacing-md);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary), var(--color-success));
    width: 0%;
    transition: width var(--transition-medium);
}

#writing-status {
    text-align: center;
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    font-weight: 500;
}

/* Chapter Controls */
.chapter-controls {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.chapter-controls h4 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

.controls-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
    align-items: center;
}

.writing-hint {
    text-align: center;
    font-size: var(--font-size-sm);
    color: var(--text-tertiary);
    margin-bottom: var(--spacing-md);
}

.writing-footer {
    text-align: center;
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--separator);
}

/* Chapter Items */
.chapter-item {
    background: var(--bg-primary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin: var(--spacing-md) 0;
    transition: all var(--transition-fast);
}

.chapter-item:hover {
    border-color: var(--border-primary);
    box-shadow: var(--shadow-small);
}

.chapter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
    flex-wrap: wrap;
    gap: var(--spacing-md);
}

.chapter-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.chapter-info h4 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.chapter-word-count {
    background: var(--bg-secondary);
    color: var(--text-tertiary);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    font-weight: 500;
}

.chapter-actions {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.chapter-status {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-md);
}

.chapter-content {
    display: none;
}

.chapter-content.active {
    display: block;
}

.chapter-textarea {
    width: 100%;
    min-height: 200px;
    font-family: 'Georgia', serif;
    font-size: var(--font-size-base);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
}

.chapter-footer {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
}

.stat-card {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    text-align: center;
    cursor: help;
    transition: all var(--transition-fast);
}

.stat-card:hover {
    border-color: var(--color-primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
}

.stat-number {
    font-size: var(--font-size-3xl);
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: var(--spacing-xs);
}

.stat-label {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    font-weight: 500;
}

.stat-explanation {
    font-size: var(--font-size-xs);
    color: var(--text-tertiary);
    margin-top: var(--spacing-xs);
    font-style: italic;
}

/* Book Title & Blurb Display */
.book-title-section {
    background: var(--bg-tertiary);
    border: 2px solid var(--color-primary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
}

.book-title-section h3 {
    color: var(--color-primary);
    text-align: center;
    margin-bottom: var(--spacing-lg);
    font-size: var(--font-size-xl);
}

.title-display, .blurb-display {
    margin-bottom: var(--spacing-lg);
}

.title-display h4, .blurb-display h4 {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
}

.book-title {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--text-primary);
    text-align: center;
    margin: var(--spacing-md) 0;
    padding: var(--spacing-md);
    background: var(--bg-primary);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--color-primary);
}

.book-blurb {
    font-size: var(--font-size-base);
    line-height: 1.7;
    color: var(--text-primary);
    padding: var(--spacing-lg);
    background: var(--bg-primary);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--color-success);
    font-style: italic;
}

/* Export Grid */
.export-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
}

.export-card {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    text-align: center;
    transition: all var(--transition-fast);
}

.export-card:hover {
    border-color: var(--border-primary);
    box-shadow: var(--shadow-medium);
    transform: translateY(-2px);
}

.export-icon {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--color-primary);
    margin-bottom: var(--spacing-md);
    background: var(--bg-secondary);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    display: inline-block;
}

.export-card h4 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.export-card p {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
}

/* Settings */
.settings-section {
    margin-bottom: var(--spacing-2xl);
}

.settings-section h3 {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-lg);
}

.api-provider-toggle {
    margin-bottom: var(--spacing-lg);
}

.toggle-group {
    display: inline-flex;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: var(--spacing-xs);
}

.toggle-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    background: none;
    border: none;
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.toggle-btn.active {
    background: var(--bg-primary);
    color: var(--text-primary);
    box-shadow: var(--shadow-small);
}

.settings-actions {
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
    margin-top: var(--spacing-lg);
}

/* Analysis Section */
.analysis-section {
    margin-top: var(--spacing-xl);
}

.analytics-actions {
    text-align: center;
    margin-top: var(--spacing-xl);
}

/* Enhanced Expand Modal */
.expand-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: none;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.expand-modal.active {
    display: flex;
    flex-direction: column;
}

.expand-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg) var(--spacing-xl);
    background: var(--bg-primary);
    border-bottom: 1px solid var(--separator);
    flex-shrink: 0;
}

.expand-title h3 {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
}

.expand-info {
    display: flex;
    gap: var(--spacing-md);
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
}

.expand-controls {
    display: flex;
    gap: var(--spacing-sm);
}

.expand-content {
    flex: 1;
    position: relative;
    overflow: hidden;
}

.expand-editor, .expand-reader {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.expand-editor textarea {
    width: 100%;
    height: 100%;
    border: none;
    outline: none;
    padding: var(--spacing-2xl);
    font-family: 'Georgia', serif;
    font-size: var(--font-size-lg);
    line-height: 1.8;
    background: var(--bg-primary);
    color: var(--text-primary);
    resize: none;
}

.expand-reader {
    padding: var(--spacing-2xl);
    overflow-y: auto;
    background: var(--bg-primary);
}

.expand-reader-content {
    max-width: 700px;
    margin: 0 auto;
    font-family: 'Georgia', serif;
    font-size: var(--font-size-lg);
    line-height: 1.8;
    color: var(--text-primary);
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 2000;
    display: none;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-large);
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg) var(--spacing-xl);
    border-bottom: 1px solid var(--separator);
}

.modal-header h3 {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--text-primary);
}

.modal-body {
    padding: var(--spacing-xl);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
    padding: var(--spacing-lg) var(--spacing-xl);
    border-top: 1px solid var(--separator);
}

/* One-Click Configuration */
.one-click-config {
    margin-top: var(--spacing-lg);
}

.config-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
    flex-wrap: wrap;
    gap: var(--spacing-sm);
}

.config-row label {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-primary);
    margin: 0;
}

.config-row select {
    min-width: 150px;
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--blur-dark);
    z-index: 3000;
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.loading-content {
    text-align: center;
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-2xl);
    box-shadow: var(--shadow-large);
    max-width: 400px;
    width: 90%;
}

.loading-spinner {
    width: 60px;
    height: 60px;
    border: 4px solid var(--border-secondary);
    border-top: 4px solid var(--color-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto var(--spacing-lg);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-lg);
}

/* Auto-save Indicator */
.auto-save-indicator {
    position: fixed;
    top: var(--spacing-lg);
    right: var(--spacing-lg);
    background: var(--color-success);
    color: white;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-lg);
    font-size: var(--font-size-sm);
    font-weight: 600;
    opacity: 0;
    transition: opacity var(--transition-medium);
    z-index: 1000;
    box-shadow: var(--shadow-medium);
}

.auto-save-indicator.show {
    opacity: 1;
}

/* Loading States */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-2xl);
}

.loading .loading-spinner {
    width: 40px;
    height: 40px;
    margin-bottom: var(--spacing-md);
}

.loading-text-small {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
}

/* Status Messages */
.success {
    background: rgba(52, 199, 89, 0.1);
    color: var(--color-success);
    border: 1px solid rgba(52, 199, 89, 0.2);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    margin: var(--spacing-md) 0;
}

.error {
    background: rgba(255, 59, 48, 0.1);
    color: var(--color-danger);
    border: 1px solid rgba(255, 59, 48, 0.2);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    margin: var(--spacing-md) 0;
}

.warning {
    background: rgba(255, 149, 0, 0.1);
    color: var(--color-warning);
    border: 1px solid rgba(255, 149, 0, 0.2);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    margin: var(--spacing-md) 0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .app-container {
        box-shadow: none;
    }
    
    .header-content {
        flex-direction: column;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
    }
    
    .header-right {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .project-controls {
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .project-selector {
        max-width: none;
    }
    
    .nav-items {
        padding: 0 var(--spacing-md);
    }
    
    .nav-item {
        min-width: 70px;
        padding: var(--spacing-sm) var(--spacing-xs);
    }
    
    .main-content {
        padding: var(--spacing-lg) var(--spacing-md);
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid, .export-grid {
        grid-template-columns: 1fr;
    }
    
    .step-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .controls-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .chapter-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .expand-header {
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: flex-start;
    }
    
    .expand-controls {
        width: 100%;
        justify-content: space-between;
    }
    
    .expand-editor textarea, .expand-reader {
        padding: var(--spacing-lg);
    }
    
    .modal-content {
        margin: var(--spacing-md);
        width: calc(100% - 2 * var(--spacing-md));
    }
    
    .config-row {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .feedback-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .feedback-buttons {
        width: 100%;
        justify-content: space-between;
    }
    
    .book-title {
        font-size: var(--font-size-xl);
    }
    
    .book-title-section {
        padding: var(--spacing-lg);
    }
    
    .settings-actions {
        flex-direction: column;
    }
    
    .donation-buttons {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .step-title {
        font-size: var(--font-size-2xl);
    }
    
    .app-title {
        font-size: var(--font-size-xl);
    }
    
    .nav-item {
        min-width: 60px;
        padding: var(--spacing-sm) var(--spacing-xs);
    }
    
    .nav-icon {
        font-size: var(--font-size-sm);
    }
    
    .nav-label {
        font-size: 10px;
    }
    
    .donation-buttons {
        grid-template-columns: 1fr;
    }
}
    </style>

</body>
</html>